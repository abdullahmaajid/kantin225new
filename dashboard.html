<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="icon" href="image/K3MERAH.png" type="image/png">
  <style>
    body {
      background-color: #f8f8f8; /* Light gray */

      font-family: "Ubuntu", sans-serif;
      font-optical-sizing: auto;
    }
    /* CSS styles as defined above */
    
    #calculateRevenue {
        background-color: #da0010;
        border-color: #da0010;
        color: white;
        width: 200px;
    }
    
    #resetRevenue {
        background-color: #da0010;
        border-color: #da0010;
        color: white;
        width: 200px;
    }

    #reloadData {
      background-color: #da0010;
      border-color: #da0010;
      color: white;
      width: 200px;
  }
  

    #calculateRevenue:hover {
      background-color: #da0010;
      border-color: #da0010;

  }
    
    #resetRevenue:hover {
      background-color: #da0010;
      border-color: #da0010;
    }
    
    #reloadData:hover {
      background-color: #da0010;
      border-color: #da0010;
    }

    /* Table header styling */
    #topItemsTable th,
    #topCustomersTable th {
        background-color: #da0010;
        color: white;
        font-weight: bold;
        text-align: center;
    }

    #topItemsTable td,
    #topCustomersTable td {
        text-align: center;
        vertical-align: middle;
    }

    /* Default logo size */
.logo-container img {
  width: 100%; /* Makes the logo take full width of the container */
  max-width: 300px; /* Sets a maximum width */
  height: auto; /* Keeps the aspect ratio */
}


/* Sidebar styles */
/* Sidebar styles */
.sidebar {
  background-color: #da0010;
  height: 100vh;
  width: 120px; /* Normal width */
  padding: 20px;
  position: fixed;
  transition: transform 1s ease, width 1s ease; /* Smooth transition */
  display: flex;
  flex-direction: column;
  align-items: center; /* Center items horizontally */
  top: 0; /* Align to top */
  left: 0; /* Align to left */
}

/* Minimized state for sidebar */
.sidebar.minimized {
  transform: translateX(-100%); /* Move completely out of view to the left */
}

/* Sidebar item styling */
.sidebar-item {
  display: flex;
  flex-direction: column; /* Stack icon and text vertically */
  align-items: center; /* Center items */
  padding: 10px 0; /* Space between items */
  color: white; /* Set text color to white */
  text-decoration: none; /* Remove underline */
  transition: background 0.3s; /* Smooth background change */
  width: 100%; /* Take full width for better centering */
}

.sidebar-item:hover {
  background-color: #da0010; /* Darker red on hover */
}

.sidebar-icon {
  max-width: 30px; /* Size for the icons */
  margin-bottom: 5px; /* Space between icon and text */
  filter: brightness(0) invert(1); /* Make icon white */
}

/* Toggle button styling */
.toggle-btn {
  background: none; /* Remove background */
  border: none; /* Remove border */
  outline: none; /* Remove outline */
  padding: 0; /* Remove padding */
  cursor: pointer; /* Make it a clickable button */
  position: absolute; /* Position it to the right */
  right: -30px; /* Position outside the sidebar */
  top: 20px; /* Adjust vertical position */
  transform: translateX(50%); /* Center the button */
}

.toggle-icon {
  max-width: 30px; /* Set the size of the image */
}

/* Content styles */
.content {
  padding: 1px;
  transition: margin-left 0.3s ease; /* Smooth transition */
}





/* Media queries for mobile */
@media (max-width: 768px) {
  .sidebar {
      width: 70px; /* Adjust sidebar width for mobile */
      height: 2000px;
  }

  .sidebar.minimized {
      width: 0; /* No width when minimized for mobile */
  }
  #calculateRevenue {

    width: 106px;
}

#resetRevenue {

  width: 106px;
}

#reloadData {

  width: 106px;
}
/* Default logo size */
/* Default logo size */
.logo-container {
  width: 200%; /* Makes the logo take full width of the container */

}
}







  </style>
</head>
<body>

  <body>
    <div class="sidebar" id="sidebar">
      <div class="logo-container text-center mb-4">
          <img src="image/K3MBP.png" alt="Kantin Logo" class="img-fluid">
      </div>
  
      <a href="dashboard.html" class="sidebar-item">
          <img src="image/dash.png" alt="Dashboard" class="sidebar-icon">
          <span></span>
      </a>
      <a href="index.html" class="sidebar-item">
          <img src="image/order.png" alt="Order" class="sidebar-icon">
          <span></span>
      </a>
      <a href="tabel.html" class="sidebar-item">
          <img src="image/tabel.png" alt="Rekap Data" class="sidebar-icon">
          <span></span>
      </a>
  
      <!-- Toggle Button for collapsing -->
      <button class="toggle-btn" id="toggleBtn">
          <img src="image/minimize.png" alt="Toggle Sidebar" class="toggle-icon">
      </button>

    </div>



   
    <!-- Main content -->
    <div class="content" id="content">
      
        <div class="container mt-4">
          <h6 class="mb-4">&nbsp;</h6>

            <!-- New Section for Date Range Revenue at the top -->
            <h2 class="mt-4">Periksa Pendapatan berdasarkan Rentang Tanggal</h2>
            <div class="mb-3">
                <label for="startDate" class="form-label">Tanggal mulai:</label>
                <input type="date" id="startDate" class="form-control">
            </div>
            <div class="mb-3">
                <label for="endDate" class="form-label">tanggal berakhir:</label>
                <input type="date" id="endDate" class="form-control">
            </div>
            <button id="calculateRevenue" class="btn btn-primary">Calculate</button>
            <button id="resetRevenue" class="btn btn-secondary">Reset</button>
            <button id="reloadData" class="btn btn-info">Reload</button>
            <div class="text-center mt-3">
                <p id="dateRangeRevenue" class="h4">Total pendapatan: Rp 0</p>
            </div>
            <canvas id="dateRangeChart" width="400" height="200" class="mt-4"></canvas>

            <h2 class="mt-4">Total Pendapatan Harian</h2>
            <div class="text-center">
                <p id="totalRevenue" class="h4">Total pendapatan: Rp 0</p>
            </div>
            <canvas id="revenueChart" width="400" height="200"></canvas>

            <h2 class="mt-4">pendapatan mingguan</h2>
            <canvas id="weeklyRevenueChart" width="400" height="200"></canvas>

            <h2 class="mt-4">pendapatan bulanan</h2>
            <canvas id="monthlyRevenueChart" width="400" height="200"></canvas>

            <div class="row d-flex align-items-stretch">
                <div class="col-md-6 d-flex flex-column">
                    <h2 class="mt-4">10 Item Teratas yang Sering Dipesan</h2>
                    <table class="table table-bordered mt-3 flex-grow-1 h-100" id="topItemsTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>Inama pesanan</th>
                                <th>Jumlah yang Dipesan</th>
                            </tr>
                        </thead>
                        <tbody id="topItemsTableBody">
                            <!-- Top items will be inserted here dynamically -->
                        </tbody>
                    </table>
                </div>
              
                <div class="col-md-6 d-flex flex-column">
                    <h2 class="mt-4">10 Pelanggan Sering Teratas</h2>
                    <table class="table table-bordered mt-3 flex-grow-1 h-100" id="topCustomersTable">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>nama pelanggan</th>
                                <th>jumlah orderan</th>
                            </tr>
                        </thead>
                        <tbody id="topCustomersTableBody">
                            <!-- Top customers will be inserted here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
  </body>


    <script>
      const toggleBtn = document.getElementById("toggleBtn");
      const sidebar = document.getElementById("sidebar");

      toggleBtn.addEventListener("click", () => {
          sidebar.classList.toggle("minimized");
      });
  </script>


 
      


  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const orders = JSON.parse(localStorage.getItem("orders")) || [];
      const dailyRevenue = {};
      const weeklyRevenue = {};
      const monthlyRevenue = {};
      const itemFrequency = {};
      const customerFrequency = {};
  
      // Function to format date as DD-MM-YYYY
      const formatDate = (dateString) => {
        const [year, month, day] = dateString.split("-");
        return `${day}-${month}-${year}`;
      };
  
      // Function to get the week of the month
      const getWeekOfMonth = (date) => {
        const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
        const dayOfWeek = firstDay.getDay();
        const adjustedDate = date.getDate() + dayOfWeek;

        return Math.ceil(adjustedDate / 7);
      };
  
      // Calculate daily revenue, item frequency, and customer frequency
      orders.forEach(order => {
        const date = order.date;
        const revenue = order.totalPrice;
  
        // Calculate daily revenue
        if (!dailyRevenue[date]) {
          dailyRevenue[date] = 0;
        }
        dailyRevenue[date] += revenue;
  
        // Calculate weekly revenue
        const orderDate = new Date(date);
        const weekOfMonth = getWeekOfMonth(orderDate);
        const month = orderDate.toLocaleString('default', { month: 'long' });
        const weekKey = `Minggu ${weekOfMonth} ${month}`;
        
        if (!weeklyRevenue[weekKey]) {
          weeklyRevenue[weekKey] = 0;
        }
        weeklyRevenue[weekKey] += revenue;
  
        // Calculate monthly revenue
        const monthKey = `Bulan ${month}`; // New format for monthly revenue
        if (!monthlyRevenue[monthKey]) {
          monthlyRevenue[monthKey] = 0;
        }
        monthlyRevenue[monthKey] += revenue;
  
        // Calculate item frequency
        order.items.forEach(item => {
          if (!itemFrequency[item.name]) {
            itemFrequency[item.name] = 0;
          }
          itemFrequency[item.name] += item.qty;
        });
  
        // Calculate customer frequency
        if (!customerFrequency[order.customerName]) {
          customerFrequency[order.customerName] = 0;
        }
        customerFrequency[order.customerName] += 1; // Count orders per customer
      });
  
      // Function to display total revenue
      const displayTotalRevenue = () => {
        const totalRevenue = Object.values(dailyRevenue).reduce((acc, curr) => acc + curr, 0);
        document.getElementById("totalRevenue").innerText = `Total Revenue: Rp ${totalRevenue.toLocaleString()}`;
      };
      displayTotalRevenue();
  
      // Create daily revenue chart
      const createDailyRevenueChart = () => {
        const dailyLabels = Object.keys(dailyRevenue).map(formatDate);
        const dailyRevenues = Object.values(dailyRevenue);
        const ctxDaily = document.getElementById('revenueChart').getContext('2d');
        new Chart(ctxDaily, {
          type: 'line',
          data: {
            labels: dailyLabels,
            datasets: [{
              label: 'Daily Revenue (Rp)',
              data: dailyRevenues,
              backgroundColor: 'rgba(218, 0, 16, 1)',
              borderColor: 'rgba(218, 0, 16, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      };
      createDailyRevenueChart();
  
      // Create weekly revenue chart
const createWeeklyRevenueChart = () => {
    const weeklyLabels = Object.keys(weeklyRevenue).map((weekKey) => {
      const weekParts = weekKey.split(' ');
      const year = new Date().getFullYear(); // Get the current year
      return `${weekParts[0]} ${weekParts[1]} ${year}`; // Append year to the week
    });
    const weeklyRevenues = Object.values(weeklyRevenue);
    const ctxWeekly = document.getElementById('weeklyRevenueChart').getContext('2d');
    new Chart(ctxWeekly, {
      type: 'bar',
      data: {
        labels: weeklyLabels,
        datasets: [{
          label: 'Weekly Revenue (Rp)',
          data: weeklyRevenues,
          backgroundColor: 'rgba(218, 0, 16, 1)',
          borderColor: 'rgba(218, 0, 16, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  };
      createWeeklyRevenueChart();
  
      // Create monthly revenue chart
const createMonthlyRevenueChart = () => {
    const monthlyLabels = Object.keys(monthlyRevenue).map((monthKey) => {
      const monthParts = monthKey.split(' ');
      const year = new Date().getFullYear(); // Get the current year
      return `${monthParts[1]} ${year}`; // Append year to the month
    });
    const monthlyRevenues = Object.values(monthlyRevenue);
    const ctxMonthly = document.getElementById('monthlyRevenueChart').getContext('2d');
    new Chart(ctxMonthly, {
      type: 'bar',
      data: {
        labels: monthlyLabels,
        datasets: [{
          label: 'Monthly Revenue (Rp)',
          data: monthlyRevenues,
          backgroundColor: 'rgba(218, 0, 16, 1)',
          borderColor: 'rgba(218, 0, 16, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  };
      createMonthlyRevenueChart();
  
      // Calculate top 10 items
      const topItems = Object.entries(itemFrequency)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      topItems.forEach(([itemName, quantity], index) => {
        const row = `<tr>
          <td>${index + 1}</td>
          <td>${itemName}</td>
          <td>${quantity}</td>
        </tr>`;
        document.getElementById('topItemsTableBody').insertAdjacentHTML('beforeend', row);
      });
  
      // Calculate top 10 customers
      const topCustomers = Object.entries(customerFrequency)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      topCustomers.forEach(([customerName, orderCount], index) => {
        const row = `<tr>
          <td>${index + 1}</td>
          <td>${customerName}</td>
          <td>${orderCount}</td>
        </tr>`;
        document.getElementById('topCustomersTableBody').insertAdjacentHTML('beforeend', row);
      });
  
      // Date range revenue calculation
      document.getElementById('calculateRevenue').addEventListener('click', () => {
        const startDate = new Date(document.getElementById('startDate').value);
        const endDate = new Date(document.getElementById('endDate').value);
        let totalRevenue = 0;
  
        // Calculate total revenue for the date range
        for (let order of orders) {
          const orderDate = new Date(order.date);
          if (orderDate >= startDate && orderDate <= endDate) {
            totalRevenue += order.totalPrice;
          }
        }
  
        document.getElementById('dateRangeRevenue').innerText = `Total Revenue: Rp ${totalRevenue.toLocaleString()}`;
  
        // Create date range chart
        const dateRangeLabels = [];
        const dateRangeData = [];
  
        for (let order of orders) {
          const orderDate = new Date(order.date);
          if (orderDate >= startDate && orderDate <= endDate) {
            const formattedDate = formatDate(order.date);
            if (!dateRangeLabels.includes(formattedDate)) {
              dateRangeLabels.push(formattedDate);
              dateRangeData.push(order.totalPrice);
            } else {
              const index = dateRangeLabels.indexOf(formattedDate);
              dateRangeData[index] += order.totalPrice; // Sum revenue for the same date
            }
          }
        }
  
        const ctxDateRange = document.getElementById('dateRangeChart').getContext('2d');
        new Chart(ctxDateRange, {
          type: 'line',
          data: {
            labels: dateRangeLabels,
            datasets: [{
              label: 'Date Range Revenue (Rp)',
              data: dateRangeData,
              backgroundColor: 'rgba(218, 0, 16, 1)',
              borderColor: 'rgba(218, 0, 16, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      });

      // Reset date range and chart
      document.getElementById('resetRevenue').addEventListener('click', () => {
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        document.getElementById('dateRangeRevenue').innerText = `Total Revenue: Rp 0`;
      });

      // Reload data
      document.getElementById('reloadData').addEventListener('click', () => {
        location.reload();
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
